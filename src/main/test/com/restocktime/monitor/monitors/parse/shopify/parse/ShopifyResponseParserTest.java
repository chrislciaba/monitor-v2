package com.restocktime.monitor.monitors.parse.shopify.parse;

import com.restocktime.monitor.helper.httprequests.model.BasicHttpResponse;
import com.restocktime.monitor.helper.keywords.KeywordSearchHelper;
import com.restocktime.monitor.helper.stocktracker.StockTracker;
import com.restocktime.monitor.notifications.attachments.AttachmentCreater;
import org.junit.Before;
import org.junit.Test;

import static org.mockito.Matchers.any;
import static org.mockito.Matchers.eq;
import static org.powermock.api.mockito.PowerMockito.mock;
import static org.powermock.api.mockito.PowerMockito.when;

public class ShopifyResponseParserTest {
    private ShopifyAbstractResponseParser shopifyResponseParser;
    private AttachmentCreater attachmentCreater;
    private KeywordSearchHelper keywordSearchHelper;
    private StockTracker stockTracker;
    private BasicHttpResponse basicHttpResponse;

    private final String SOLD_OUT_RESP = "{\"id\":1402676707397,\"title\":\"WHITE\",\"handle\":\"broadway\",\"description\":\"\\u003cp\\u003eChuck Taylor All Star 70s High Silhouette\\u003c\\/p\\u003e\\n\\u003cp\\u003eDenim twill fabric\\u003c\\/p\\u003e\\n\\u003cp\\u003eFrayed trim detailing\\u003c\\/p\\u003e\\n\\u003cp\\u003eMetal eyelets\\u003c\\/p\\u003e\\n\\u003cp\\u003eTwo lace options (one is co-branded)\\u003c\\/p\\u003e\\n\\u003cp\\u003eEmbroidered Coca-Cola branding on upper\\u003c\\/p\\u003e\\n\\u003cp\\u003eRubber toe box\\u003c\\/p\\u003e\\n\\u003cp\\u003eVintage license plate heel branding\\u003c\\/p\\u003e\\n\\u003cp\\u003eMedial tumbled leather Velcro Itâ€™s the real thing patch with concealed Converse patch\\u003c\\/p\\u003e\\n\\u003cp\\u003eHigh rubber foxing\\u003c\\/p\\u003e\\n\\u003cp\\u003eCustom insole artwork\\u003c\\/p\\u003e\\n\\u003cp\\u003eCustom signature tongue label\\u003c\\/p\\u003e\\n\\u003cp\\u003eVulcanized off-white rubber midsole with debossed branding\\u003c\\/p\\u003e\\n\\u003cp\\u003eRubberized Kith classic logo on midsole\\u003c\\/p\\u003e\\n\\u003cp\\u003eReinforced toe cap\\u003c\\/p\\u003e\\n\\u003cp\\u003eSemi-translucent green rubber outsole inspired by vintage Coke bottles\\u003c\\/p\\u003e\\n\\u003cp\\u003eCustom packaging\\u003c\\/p\\u003e\\n\\u003cp\\u003e \\u003c\\/p\\u003e\\n\\u003cp\\u003eStyle: CN162986C\\u003c\\/p\\u003e\\n\\u003cp\\u003eColor: Russia\\u003c\\/p\\u003e\\n\\u003cp\\u003eMaterial: Denim\\u003c\\/p\\u003e\",\"published_at\":\"2018-08-17T20:46:51-04:00\",\"created_at\":\"2018-08-07T12:08:20-04:00\",\"vendor\":\"Kith\",\"type\":\"Sneakers\",\"tags\":[\"70s Hi\",\"81718\",\"81718m\",\"bocabola\",\"Chuck 70s Hi\",\"cn162986c\",\"final-sale\",\"footwear\",\"Kith x Coca-Cola\",\"Kith x Coca-Cola x Converse Chuck 70s Hi\",\"Kith x Coca-Cola x Converse Chuck 70s Hi - Russia\",\"limit-quantity-two\",\"mens\",\"Russia\",\"sneaker\",\"sneakers\"],\"price\":15000,\"price_min\":15000,\"price_max\":15000,\"available\":false,\"price_varies\":false,\"compare_at_price\":0,\"compare_at_price_min\":0,\"compare_at_price_max\":0,\"compare_at_price_varies\":false,\"variants\":[{\"id\":12574882791493,\"title\":\"3\",\"option1\":\"3\",\"option2\":null,\"option3\":null,\"sku\":\"888756059783\",\"requires_shipping\":true,\"taxable\":true,\"featured_image\":null,\"available\":false,\"name\":\"WHITE - 3\",\"public_title\":\"3\",\"options\":[\"3\"],\"price\":15000,\"weight\":1361,\"compare_at_price\":0,\"inventory_management\":\"shopify\",\"barcode\":null},{\"id\":12574882857029,\"title\":\"3.5\",\"option1\":\"3.5\",\"option2\":null,\"option3\":null,\"sku\":\"888756059790\",\"requires_shipping\":true,\"taxable\":true,\"featured_image\":null,\"available\":false,\"name\":\"WHITE - 3.5\",\"public_title\":\"3.5\",\"options\":[\"3.5\"],\"price\":15000,\"weight\":1361,\"compare_at_price\":0,\"inventory_management\":\"shopify\",\"barcode\":null},{\"id\":12574882922565,\"title\":\"4\",\"option1\":\"4\",\"option2\":null,\"option3\":null,\"sku\":\"888756059806\",\"requires_shipping\":true,\"taxable\":true,\"featured_image\":null,\"available\":false,\"name\":\"WHITE - 4\",\"public_title\":\"4\",\"options\":[\"4\"],\"price\":15000,\"weight\":1361,\"compare_at_price\":0,\"inventory_management\":\"shopify\",\"barcode\":null},{\"id\":12574883020869,\"title\":\"4.5\",\"option1\":\"4.5\",\"option2\":null,\"option3\":null,\"sku\":\"888756059813\",\"requires_shipping\":true,\"taxable\":true,\"featured_image\":null,\"available\":false,\"name\":\"WHITE - 4.5\",\"public_title\":\"4.5\",\"options\":[\"4.5\"],\"price\":15000,\"weight\":1361,\"compare_at_price\":0,\"inventory_management\":\"shopify\",\"barcode\":null},{\"id\":12574883053637,\"title\":\"5\",\"option1\":\"5\",\"option2\":null,\"option3\":null,\"sku\":\"888756059820\",\"requires_shipping\":true,\"taxable\":true,\"featured_image\":null,\"available\":false,\"name\":\"WHITE - 5\",\"public_title\":\"5\",\"options\":[\"5\"],\"price\":15000,\"weight\":1361,\"compare_at_price\":0,\"inventory_management\":\"shopify\",\"barcode\":null},{\"id\":12574883119173,\"title\":\"5.5\",\"option1\":\"5.5\",\"option2\":null,\"option3\":null,\"sku\":\"888756059837\",\"requires_shipping\":true,\"taxable\":true,\"featured_image\":null,\"available\":false,\"name\":\"WHITE - 5.5\",\"public_title\":\"5.5\",\"options\":[\"5.5\"],\"price\":15000,\"weight\":1361,\"compare_at_price\":0,\"inventory_management\":\"shopify\",\"barcode\":null},{\"id\":12574883184709,\"title\":\"6\",\"option1\":\"6\",\"option2\":null,\"option3\":null,\"sku\":\"888756059844\",\"requires_shipping\":true,\"taxable\":true,\"featured_image\":null,\"available\":false,\"name\":\"WHITE - 6\",\"public_title\":\"6\",\"options\":[\"6\"],\"price\":15000,\"weight\":1361,\"compare_at_price\":0,\"inventory_management\":\"shopify\",\"barcode\":null},{\"id\":12574883217477,\"title\":\"6.5\",\"option1\":\"6.5\",\"option2\":null,\"option3\":null,\"sku\":\"888756059851\",\"requires_shipping\":true,\"taxable\":true,\"featured_image\":null,\"available\":false,\"name\":\"WHITE - 6.5\",\"public_title\":\"6.5\",\"options\":[\"6.5\"],\"price\":15000,\"weight\":1361,\"compare_at_price\":0,\"inventory_management\":\"shopify\",\"barcode\":null},{\"id\":12574883315781,\"title\":\"7\",\"option1\":\"7\",\"option2\":null,\"option3\":null,\"sku\":\"888756059868\",\"requires_shipping\":true,\"taxable\":true,\"featured_image\":null,\"available\":false,\"name\":\"WHITE - 7\",\"public_title\":\"7\",\"options\":[\"7\"],\"price\":15000,\"weight\":1361,\"compare_at_price\":0,\"inventory_management\":\"shopify\",\"barcode\":null},{\"id\":12574883381317,\"title\":\"7.5\",\"option1\":\"7.5\",\"option2\":null,\"option3\":null,\"sku\":\"888756059875\",\"requires_shipping\":true,\"taxable\":true,\"featured_image\":null,\"available\":false,\"name\":\"WHITE - 7.5\",\"public_title\":\"7.5\",\"options\":[\"7.5\"],\"price\":15000,\"weight\":1361,\"compare_at_price\":0,\"inventory_management\":\"shopify\",\"barcode\":null},{\"id\":12574883479621,\"title\":\"8\",\"option1\":\"8\",\"option2\":null,\"option3\":null,\"sku\":\"888756059882\",\"requires_shipping\":true,\"taxable\":true,\"featured_image\":null,\"available\":false,\"name\":\"WHITE - 8\",\"public_title\":\"8\",\"options\":[\"8\"],\"price\":15000,\"weight\":1361,\"compare_at_price\":0,\"inventory_management\":\"shopify\",\"barcode\":null},{\"id\":12574883545157,\"title\":\"8.5\",\"option1\":\"8.5\",\"option2\":null,\"option3\":null,\"sku\":\"888756059899\",\"requires_shipping\":true,\"taxable\":true,\"featured_image\":null,\"available\":false,\"name\":\"WHITE - 8.5\",\"public_title\":\"8.5\",\"options\":[\"8.5\"],\"price\":15000,\"weight\":1361,\"compare_at_price\":0,\"inventory_management\":\"shopify\",\"barcode\":null},{\"id\":12574883643461,\"title\":\"9\",\"option1\":\"9\",\"option2\":null,\"option3\":null,\"sku\":\"888756059905\",\"requires_shipping\":true,\"taxable\":true,\"featured_image\":null,\"available\":false,\"name\":\"WHITE - 9\",\"public_title\":\"9\",\"options\":[\"9\"],\"price\":15000,\"weight\":1361,\"compare_at_price\":0,\"inventory_management\":\"shopify\",\"barcode\":null},{\"id\":12574883708997,\"title\":\"9.5\",\"option1\":\"9.5\",\"option2\":null,\"option3\":null,\"sku\":\"888756059912\",\"requires_shipping\":true,\"taxable\":true,\"featured_image\":null,\"available\":false,\"name\":\"WHITE - 9.5\",\"public_title\":\"9.5\",\"options\":[\"9.5\"],\"price\":15000,\"weight\":1361,\"compare_at_price\":0,\"inventory_management\":\"shopify\",\"barcode\":null},{\"id\":12574883774533,\"title\":\"10\",\"option1\":\"10\",\"option2\":null,\"option3\":null,\"sku\":\"888756059721\",\"requires_shipping\":true,\"taxable\":true,\"featured_image\":null,\"available\":false,\"name\":\"WHITE - 10\",\"public_title\":\"10\",\"options\":[\"10\"],\"price\":15000,\"weight\":1361,\"compare_at_price\":0,\"inventory_management\":\"shopify\",\"barcode\":null},{\"id\":12574883807301,\"title\":\"10.5\",\"option1\":\"10.5\",\"option2\":null,\"option3\":null,\"sku\":\"888756059738\",\"requires_shipping\":true,\"taxable\":true,\"featured_image\":null,\"available\":false,\"name\":\"WHITE - 10.5\",\"public_title\":\"10.5\",\"options\":[\"10.5\"],\"price\":15000,\"weight\":1361,\"compare_at_price\":0,\"inventory_management\":\"shopify\",\"barcode\":null},{\"id\":12574883840069,\"title\":\"11\",\"option1\":\"11\",\"option2\":null,\"option3\":null,\"sku\":\"888756059745\",\"requires_shipping\":true,\"taxable\":true,\"featured_image\":null,\"available\":false,\"name\":\"WHITE - 11\",\"public_title\":\"11\",\"options\":[\"11\"],\"price\":15000,\"weight\":1361,\"compare_at_price\":0,\"inventory_management\":\"shopify\",\"barcode\":null},{\"id\":12574883872837,\"title\":\"11.5\",\"option1\":\"11.5\",\"option2\":null,\"option3\":null,\"sku\":\"888756059752\",\"requires_shipping\":true,\"taxable\":true,\"featured_image\":null,\"available\":false,\"name\":\"WHITE - 11.5\",\"public_title\":\"11.5\",\"options\":[\"11.5\"],\"price\":15000,\"weight\":1361,\"compare_at_price\":0,\"inventory_management\":\"shopify\",\"barcode\":null},{\"id\":12574883905605,\"title\":\"12\",\"option1\":\"12\",\"option2\":null,\"option3\":null,\"sku\":\"888756059769\",\"requires_shipping\":true,\"taxable\":true,\"featured_image\":null,\"available\":false,\"name\":\"WHITE - 12\",\"public_title\":\"12\",\"options\":[\"12\"],\"price\":15000,\"weight\":1361,\"compare_at_price\":0,\"inventory_management\":\"shopify\",\"barcode\":null},{\"id\":12574883938373,\"title\":\"12.5\",\"option1\":\"12.5\",\"option2\":null,\"option3\":null,\"sku\":\"986134878\",\"requires_shipping\":true,\"taxable\":true,\"featured_image\":null,\"available\":false,\"name\":\"WHITE - 12.5\",\"public_title\":\"12.5\",\"options\":[\"12.5\"],\"price\":15000,\"weight\":1361,\"compare_at_price\":0,\"inventory_management\":\"shopify\",\"barcode\":null},{\"id\":12574883971141,\"title\":\"13\",\"option1\":\"13\",\"option2\":null,\"option3\":null,\"sku\":\"888756059776\",\"requires_shipping\":true,\"taxable\":true,\"featured_image\":null,\"available\":false,\"name\":\"WHITE - 13\",\"public_title\":\"13\",\"options\":[\"13\"],\"price\":15000,\"weight\":1361,\"compare_at_price\":0,\"inventory_management\":\"shopify\",\"barcode\":null},{\"id\":12574884003909,\"title\":\"13.5\",\"option1\":\"13.5\",\"option2\":null,\"option3\":null,\"sku\":\"986134880\",\"requires_shipping\":true,\"taxable\":true,\"featured_image\":null,\"available\":false,\"name\":\"WHITE - 13.5\",\"public_title\":\"13.5\",\"options\":[\"13.5\"],\"price\":15000,\"weight\":1361,\"compare_at_price\":0,\"inventory_management\":\"shopify\",\"barcode\":null},{\"id\":12574884036677,\"title\":\"14\",\"option1\":\"14\",\"option2\":null,\"option3\":null,\"sku\":\"986134881\",\"requires_shipping\":true,\"taxable\":true,\"featured_image\":null,\"available\":false,\"name\":\"WHITE - 14\",\"public_title\":\"14\",\"options\":[\"14\"],\"price\":15000,\"weight\":1361,\"compare_at_price\":0,\"inventory_management\":\"shopify\",\"barcode\":null},{\"id\":12574884069445,\"title\":\"14.5\",\"option1\":\"14.5\",\"option2\":null,\"option3\":null,\"sku\":\"986134882\",\"requires_shipping\":true,\"taxable\":true,\"featured_image\":null,\"available\":false,\"name\":\"WHITE - 14.5\",\"public_title\":\"14.5\",\"options\":[\"14.5\"],\"price\":15000,\"weight\":1361,\"compare_at_price\":0,\"inventory_management\":\"shopify\",\"barcode\":null},{\"id\":12574884102213,\"title\":\"15\",\"option1\":\"15\",\"option2\":null,\"option3\":null,\"sku\":\"986134883\",\"requires_shipping\":true,\"taxable\":true,\"featured_image\":null,\"available\":false,\"name\":\"WHITE - 15\",\"public_title\":\"15\",\"options\":[\"15\"],\"price\":15000,\"weight\":1361,\"compare_at_price\":0,\"inventory_management\":\"shopify\",\"barcode\":null}],\"images\":[\"\\/\\/cdn.shopify.com\\/s\\/files\\/1\\/0094\\/2252\\/products\\/DSC_9432_c151afc9-62be-4ce4-8cf9-640e4849c9a7.jpg?v=1534280655\",\"\\/\\/cdn.shopify.com\\/s\\/files\\/1\\/0094\\/2252\\/products\\/DSC_9434_408f5725-346e-4cea-97f6-58620ed2f5c0.jpg?v=1534280655\",\"\\/\\/cdn.shopify.com\\/s\\/files\\/1\\/0094\\/2252\\/products\\/DSC_9440_8c2456bd-eb55-4938-b481-98c9ab945220.jpg?v=1534280655\",\"\\/\\/cdn.shopify.com\\/s\\/files\\/1\\/0094\\/2252\\/products\\/DSC_9437_88d6d63e-945b-4279-b8b6-23f5b5f8de9b.jpg?v=1534280655\",\"\\/\\/cdn.shopify.com\\/s\\/files\\/1\\/0094\\/2252\\/products\\/DSC_9439_43c50cce-dfc0-4440-83bb-47926280e620.jpg?v=1534280655\",\"\\/\\/cdn.shopify.com\\/s\\/files\\/1\\/0094\\/2252\\/products\\/DSC_9441_c9f76e5e-64e3-4f0b-ae82-d7855967e1ef.jpg?v=1534280655\",\"\\/\\/cdn.shopify.com\\/s\\/files\\/1\\/0094\\/2252\\/products\\/DSC_9443_bb8d6724-b819-4f38-b9e9-2d0c8aff29bc.jpg?v=1534280655\",\"\\/\\/cdn.shopify.com\\/s\\/files\\/1\\/0094\\/2252\\/products\\/DSC_9446_a61933d8-32cc-4c75-8ff9-11e905c1342b.jpg?v=1534280655\",\"\\/\\/cdn.shopify.com\\/s\\/files\\/1\\/0094\\/2252\\/products\\/DSC_9367_2162e794-056d-4d25-a996-f1396b369ab2.jpg?v=1534280655\",\"\\/\\/cdn.shopify.com\\/s\\/files\\/1\\/0094\\/2252\\/products\\/DSC_9366_fafa87e9-2ec4-4f2c-9a2c-c3b050119e96.jpg?v=1534280655\"],\"featured_image\":\"\\/\\/cdn.shopify.com\\/s\\/files\\/1\\/0094\\/2252\\/products\\/DSC_9432_c151afc9-62be-4ce4-8cf9-640e4849c9a7.jpg?v=1534280655\",\"options\":[{\"name\":\"Size\",\"position\":1,\"values\":[\"3\",\"3.5\",\"4\",\"4.5\",\"5\",\"5.5\",\"6\",\"6.5\",\"7\",\"7.5\",\"8\",\"8.5\",\"9\",\"9.5\",\"10\",\"10.5\",\"11\",\"11.5\",\"12\",\"12.5\",\"13\",\"13.5\",\"14\",\"14.5\",\"15\"]}],\"url\":\"\\/products\\/broadway\"}";
    private final String IN_STOCK_RESP = "{\"id\":1402686013509,\"title\":\"Kith Women x Coca-Cola Swim One Piece - Red\",\"handle\":\"kith-women-x-coca-cola-swim-one-piece-red\",\"description\":\"\\u003cp\\u003e\\u003cspan style=\\\"font-weight: 400;\\\"\\u003eNylon-spandex blend fabric\\u003c\\/span\\u003e\\u003c\\/p\\u003e\\n\\u003cp\\u003e\\u003cspan style=\\\"font-weight: 400;\\\"\\u003eAll-over pattern\\u003c\\/span\\u003e\\u003c\\/p\\u003e\\n\\u003cp\\u003e\\u003cspan style=\\\"font-weight: 400;\\\"\\u003eV-neck front neckline\\u003c\\/span\\u003e\\u003c\\/p\\u003e\\n\\u003cp\\u003e\\u003cspan style=\\\"font-weight: 400;\\\"\\u003eShoulder straps can be worn in two ways: crossed over or straight\\u003c\\/span\\u003e\\u003c\\/p\\u003e\\n\\u003cp\\u003e\\u003cspan style=\\\"font-weight: 400;\\\"\\u003eLow back cut\\u003c\\/span\\u003e\\u003c\\/p\\u003e\\n\\u003cp\\u003eTwo way back tie on rear\\u003c\\/p\\u003e\\n\\u003cp\\u003e \\u003c\\/p\\u003e\\n\\u003cp\\u003eStyle: KHW9054-110\\u003c\\/p\\u003e\\n\\u003cp\\u003eColor: Red\\u003c\\/p\\u003e\\n\\u003cp\\u003eMaterial: 85% Nylon \\/ 15% Spandex\\u003c\\/p\\u003e\",\"published_at\":\"2018-08-17T18:12:43-04:00\",\"created_at\":\"2018-08-07T12:10:54-04:00\",\"vendor\":\"Kith Women\",\"type\":\"Bathing Suit\",\"tags\":[\"81718\",\"81718w\",\"apparel\",\"bocabola\",\"final-sale\",\"khw9054-110\",\"Kith x Coca-Cola\",\"Kith x Coca-Cola Swim One Piece\",\"Kith x Coca-Cola Swim One Piece - Red\",\"limit-quantity\",\"onepiece\",\"productsize-l\",\"productsize-m\",\"productsize-s\",\"productsize-xs\",\"Red\",\"Swim One Piece\",\"wmns\"],\"price\":16500,\"price_min\":16500,\"price_max\":16500,\"available\":true,\"price_varies\":false,\"compare_at_price\":0,\"compare_at_price_min\":0,\"compare_at_price_max\":0,\"compare_at_price_varies\":false,\"variants\":[{\"id\":12574950064197,\"title\":\"XS\",\"option1\":\"XS\",\"option2\":null,\"option3\":null,\"sku\":\"808500\",\"requires_shipping\":true,\"taxable\":true,\"featured_image\":null,\"available\":false,\"name\":\"Kith Women x Coca-Cola Swim One Piece - Red - XS\",\"public_title\":\"XS\",\"options\":[\"XS\"],\"price\":16500,\"weight\":1361,\"compare_at_price\":0,\"inventory_management\":\"shopify\",\"barcode\":null},{\"id\":12574950096965,\"title\":\"S\",\"option1\":\"S\",\"option2\":null,\"option3\":null,\"sku\":\"808501\",\"requires_shipping\":true,\"taxable\":true,\"featured_image\":null,\"available\":false,\"name\":\"Kith Women x Coca-Cola Swim One Piece - Red - S\",\"public_title\":\"S\",\"options\":[\"S\"],\"price\":16500,\"weight\":1361,\"compare_at_price\":0,\"inventory_management\":\"shopify\",\"barcode\":null},{\"id\":12574950162501,\"title\":\"M\",\"option1\":\"M\",\"option2\":null,\"option3\":null,\"sku\":\"808502\",\"requires_shipping\":true,\"taxable\":true,\"featured_image\":null,\"available\":false,\"name\":\"Kith Women x Coca-Cola Swim One Piece - Red - M\",\"public_title\":\"M\",\"options\":[\"M\"],\"price\":16500,\"weight\":1361,\"compare_at_price\":0,\"inventory_management\":\"shopify\",\"barcode\":null},{\"id\":12574950195269,\"title\":\"L\",\"option1\":\"L\",\"option2\":null,\"option3\":null,\"sku\":\"808503\",\"requires_shipping\":true,\"taxable\":true,\"featured_image\":null,\"available\":true,\"name\":\"Kith Women x Coca-Cola Swim One Piece - Red - L\",\"public_title\":\"L\",\"options\":[\"L\"],\"price\":16500,\"weight\":1361,\"compare_at_price\":0,\"inventory_management\":\"shopify\",\"barcode\":null},{\"id\":12574950260805,\"title\":\"XL\",\"option1\":\"XL\",\"option2\":null,\"option3\":null,\"sku\":\"808504\",\"requires_shipping\":true,\"taxable\":true,\"featured_image\":null,\"available\":false,\"name\":\"Kith Women x Coca-Cola Swim One Piece - Red - XL\",\"public_title\":\"XL\",\"options\":[\"XL\"],\"price\":16500,\"weight\":1361,\"compare_at_price\":0,\"inventory_management\":\"shopify\",\"barcode\":null},{\"id\":12574950326341,\"title\":\"XXL\",\"option1\":\"XXL\",\"option2\":null,\"option3\":null,\"sku\":\"808505\",\"requires_shipping\":true,\"taxable\":true,\"featured_image\":null,\"available\":false,\"name\":\"Kith Women x Coca-Cola Swim One Piece - Red - XXL\",\"public_title\":\"XXL\",\"options\":[\"XXL\"],\"price\":16500,\"weight\":1361,\"compare_at_price\":0,\"inventory_management\":\"shopify\",\"barcode\":null},{\"id\":12574950359109,\"title\":\"XXXL\",\"option1\":\"XXXL\",\"option2\":null,\"option3\":null,\"sku\":\"808506\",\"requires_shipping\":true,\"taxable\":true,\"featured_image\":null,\"available\":false,\"name\":\"Kith Women x Coca-Cola Swim One Piece - Red - XXXL\",\"public_title\":\"XXXL\",\"options\":[\"XXXL\"],\"price\":16500,\"weight\":1361,\"compare_at_price\":0,\"inventory_management\":\"shopify\",\"barcode\":null}],\"images\":[\"\\/\\/cdn.shopify.com\\/s\\/files\\/1\\/0094\\/2252\\/products\\/KH3317-110-61.jpg?v=1534279754\",\"\\/\\/cdn.shopify.com\\/s\\/files\\/1\\/0094\\/2252\\/products\\/KHW9054-110.jpg?v=1534457461\",\"\\/\\/cdn.shopify.com\\/s\\/files\\/1\\/0094\\/2252\\/products\\/KHW9054-110B.jpg?v=1534457463\",\"\\/\\/cdn.shopify.com\\/s\\/files\\/1\\/0094\\/2252\\/products\\/KHW9054-110C.jpg?v=1534457464\",\"\\/\\/cdn.shopify.com\\/s\\/files\\/1\\/0094\\/2252\\/products\\/KHW9054-110D.jpg?v=1534457466\",\"\\/\\/cdn.shopify.com\\/s\\/files\\/1\\/0094\\/2252\\/products\\/KHW9054-110E.jpg?v=1534457467\",\"\\/\\/cdn.shopify.com\\/s\\/files\\/1\\/0094\\/2252\\/products\\/KHW9054-110F.jpg?v=1534457469\",\"\\/\\/cdn.shopify.com\\/s\\/files\\/1\\/0094\\/2252\\/products\\/KHW9054-110G.jpg?v=1534457471\",\"\\/\\/cdn.shopify.com\\/s\\/files\\/1\\/0094\\/2252\\/products\\/KHW9054-110H.jpg?v=1534457472\",\"\\/\\/cdn.shopify.com\\/s\\/files\\/1\\/0094\\/2252\\/products\\/KHW9054-110I.jpg?v=1534457473\"],\"featured_image\":\"\\/\\/cdn.shopify.com\\/s\\/files\\/1\\/0094\\/2252\\/products\\/KH3317-110-61.jpg?v=1534279754\",\"options\":[{\"name\":\"Size\",\"position\":1,\"values\":[\"XS\",\"S\",\"M\",\"L\",\"XL\",\"XXL\",\"XXXL\"]}],\"url\":\"\\/products\\/kith-women-x-coca-cola-swim-one-piece-red\"}";

    @Before
    public void setup(){
        attachmentCreater = mock(AttachmentCreater.class);
        keywordSearchHelper = mock(KeywordSearchHelper.class);

        String testInput = IN_STOCK_RESP;
        when(keywordSearchHelper.search("Nike Air Max 1 (Dark Grey/Fierce Purple/Black)")).thenReturn(true);

        basicHttpResponse = mock(BasicHttpResponse.class);
        when(basicHttpResponse.getBody()).thenReturn(testInput);
        when(basicHttpResponse.getResponseCode()).thenReturn(200);
        when(attachmentCreater.isEmpty()).thenReturn(false);
        stockTracker = mock(StockTracker.class);
        when(stockTracker.notifyForObject("12574950195269", false)).thenReturn(true);


     //   shopifyResponseParser = new ShopifyAbstractResponseParser(stockTracker, "https://url.com");//"https://url.com", 0, s, d, attachmentCreater, httpRequestHelper, keywordSearchHelper, stockTracker);
    }

    @Test
    public void testInStock(){
        shopifyResponseParser.parse(basicHttpResponse, attachmentCreater, false);
 //       Mockito.verify(attachmentCreater, Mockito.times(1)).addMessages(eq("https://url.com"), eq("KITH WOMEN X COCA-COLA SWIM ONE PIECE - RED"), eq("Shopify (url.com)"), any(), any(), eq("https://cdn.shopify.com/s/files/1/0094/2252/products/KH3317-110-61.jpg?v=1534279754"));

    }

    @Test
    public void testOOS(){
        String testInput = SOLD_OUT_RESP;

        when(basicHttpResponse.getBody()).thenReturn(testInput);

        shopifyResponseParser.parse(basicHttpResponse, attachmentCreater, false);
     //   Mockito.verify(attachmentCreater, Mockito.times(0)).addMessages(any(), any(), any(), any(), any(), any());

    }

    @Test
    public void testIsFirstTime(){
        when(stockTracker.notifyForObject("12574950195269", false)).thenReturn(false);
        shopifyResponseParser.parse(basicHttpResponse, attachmentCreater, false);
    //    Mockito.verify(attachmentCreater, Mockito.times(0)).addMessages(any(), any(), any(), any(), any(), any());
    }
}
